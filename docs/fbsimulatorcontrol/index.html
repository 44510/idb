<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<script src="https://buttons.github.io/buttons.js"></script><title data-react-helmet="true">FBSimulatorControl | idb</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://fbidb.io/docs/fbsimulatorcontrol"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="FBSimulatorControl | idb"><meta data-react-helmet="true" name="description" content="FBSimulatorControl is the macOS Framework that implements all functionality associated with iOS Simulators within idb. It can be used independently of idb as it is a standalone Framework."><meta data-react-helmet="true" property="og:description" content="FBSimulatorControl is the macOS Framework that implements all functionality associated with iOS Simulators within idb. It can be used independently of idb as it is a standalone Framework."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://fbidb.io/docs/fbsimulatorcontrol"><link data-react-helmet="true" rel="alternate" href="https://fbidb.io/docs/fbsimulatorcontrol" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://fbidb.io/docs/fbsimulatorcontrol" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.6e0f608a.css">
<link rel="preload" href="/assets/js/runtime~main.ae795ba2.js" as="script">
<link rel="preload" href="/assets/js/main.c677850e.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title">idb</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/overview">Getting Started</a><a class="navbar__item navbar__link" href="/docs/installation">Docs</a><a href="https://github.com/facebook/idb" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/guided-tour">Guided Tour</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/development">Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/commands">Commands</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/fbsimulatorcontrol">FBSimulatorControl</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/fbdevicecontrol">FBDeviceControl</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/video">Video</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/test-execution">Test Execution</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/file-containers">File Containers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/accessibility">Accessibility Automation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/faqs">Frequently Asked Questions</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>FBSimulatorControl</h1></header><p><code>FBSimulatorControl</code> is the macOS Framework that implements all functionality associated with iOS Simulators within <code>idb</code>. It can be used independently of <code>idb</code> as it is a standalone Framework.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="coresimulatorframework"><code>CoreSimulator.framework</code><a aria-hidden="true" class="hash-link" href="#coresimulatorframework" title="Direct link to heading">â€‹</a></h2><p><code>CoreSimulator</code> is the Private Framework that is the interface for most Simulator related functionality on macOS. In previous Xcode versions, <code>CoreSimulator</code> was bundled inside of Xcode, but it is now installed at the System level just like <code>MobileDevice.framework</code>. It may be upgraded to a newer version as part of the install process of Xcode itself.</p><p><code>CoreSimulator</code> is used by Xcode and <code>simctl</code> as the Framework used to manipulate Simulators. It has Objective-C classes representing a set of Simulators within a directory (<code>SimDeviceSet</code> wrapped by <code>FBSimulatorSet</code>) and an individual iOS Simulator (<code>SimDevice</code>, wrapped by <code>FBSimulator</code>). There is also a Class that behaves a lot like an &quot;entrypoint&quot; to the Framework in <code>SimServiceContext</code>, this performs initialization of external services and is aware of the various configurations of Simulators that are availabile.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="simctl"><code>simctl</code><a aria-hidden="true" class="hash-link" href="#simctl" title="Direct link to heading">â€‹</a></h2><p><code>simctl</code> is essentially a CLI that exposes iOS Simulator functionality by linking and using <code>CoreSimulator</code>. This binary is bundled inside of Xcode, and typically addressed via usage of the <code>xcrun</code> command. <code>xcrun</code> is essentially a trampoline that addresses binaries that are bundled within Xcode by using the value defined in <code>xcode-select</code></p><p>The overwhelming majority of Simulator functionality is not implemented in <code>simctl</code>, it is implemented within <code>CoreSimulator</code> with <code>simctl</code> providing an accessible way of using this functionality. Having this behaviour implemented at the Framework level so that <code>Simulator.app</code> and <code>simctl</code> behave identically when using their user interfaces.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="coresimulatorservice"><code>CoreSimulatorService</code><a aria-hidden="true" class="hash-link" href="#coresimulatorservice" title="Direct link to heading">â€‹</a></h2><p><code>CoreSimulatorService</code> is a user-level daemon that is bootstrapped by any usage of <code>SimServiceContext</code>, effectively any usage of iOS Simulators will cause this service to be created and launched. This is an XPC service contained within the <code>CoreSimulator.framework</code> bundle. This service is responsible for starting and managing Simulators.</p><p>When using <code>CoreSimulator</code> as a client Framework it will transparently communicate with <code>CoreSimulatorService</code>. The overwhelming majority of <code>CoreSimulator</code> APIs that do meaningful work are essentially performing IO to <code>CoreSimulatorService</code>, though the asynchronous nature of this work isn&#x27;t completely consistent. Some <code>CoreSimulator</code> APIs (for instance those associated with <a href="https://github.com/facebook/idb/blob/main/PrivateHeaders/CoreSimulator/SimDevice.h#L75" target="_blank" rel="noopener noreferrer">launching an iOS Application</a>) do have asynchronous methods, but others (such as the <a href="https://github.com/facebook/idb/blob/main/PrivateHeaders/CoreSimulator/SimServiceContext.h#L26" target="_blank" rel="noopener noreferrer">instantiation of a <code>SimServiceContext</code></a>) do not. <code>CoreSimulatorService</code> still gets much of it&#x27;s implementation from <code>CoreSimulator.framework</code>, touching different areas of the API.</p><p>Having the &quot;work&quot; of iOS Simulators performed within the context of share user daemon is likely due to the needs to synchronize and consolidate state. The service is also an effective caching mechanism for runtime and device profiles. There are a few downsides to this approach. Firstly, <code>CoreSimulatorService</code> is effectively a single point of failure. If <code>CoreSimulatorService</code> becomes stuck, or a client of <code>CoreSimulator</code> exhibits pathological behaviour, then all iOS Simulator functionality on a given host will fail. iOS Simulator functionality will effectively halt until <code>CoreSimulatorService</code> restarts, either by the hung <code>CoreSimulatorService</code> terminating and restarting or via reboot.</p><p>Secondly, the lifecycle of <code>CoreSimulatorService</code> is tied to that of the selected <code>Xcode</code>. This means that different versions of Xcode cannot be used concurrently on the same host; <code>CoreSimulatorService</code> can only be aware of a single Xcode at any point in time. Switching Xcodes and fetching a new <code>CoreSimulatorService</code> (for instance via a <code>simctl</code> command) will cause <code>CoreSimulatorService</code> to restart, disconnecting existing clients and killing booted Simulators.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="simruntime"><code>SimRuntime</code><a aria-hidden="true" class="hash-link" href="#simruntime" title="Direct link to heading">â€‹</a></h2><p>An iOS Simulator Runtime is all of the required components for running an iOS Simulator of a given iOS version. This is a bundle, where the contents closely match the makeup of the files on disk on a physical device. This includes binaries that are compiled for the host architecture (x86_64 in the case of Intel Macs, ARM64 in the case of ARM based Macs) as well as Frameworks. The Frameworks within a SimRuntime match those of iOS, instead of those of the macOS host. There are often subtle differences in the iOS and macOS APIs, even within the same Framework. A single <code>SimRuntime</code> represents a single iOS version.</p><p>Each version of Xcode is bundled with <code>SimRuntime</code>s for the most recent iOS version that is relevant for the Xcode version across iOS, tvOS and watchOS. However, additional iOS Versions can be supported on a given version of Xcode via the &quot;Components&quot; section within <code>Xcode.app</code>. These bundles are then installed into <code>/Library/Developer/CoreSimulator/Profiles/Runtimes</code> on the host system. Runtime bundles are backwards, but not forwards compatible. For example, Xcode 11 has support for iOS 13 (the latest iOS version associated with this Xcode version) and earlier versions of iOS, but not for iOS 14.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="launchd_sim"><code>launchd_sim</code><a aria-hidden="true" class="hash-link" href="#launchd_sim" title="Direct link to heading">â€‹</a></h2><p>iOS, like macOS has <code>launchd</code> as it&#x27;s &quot;root process&quot; (often PID 1). However, iOS Simulators have their own version of <code>launchd</code> as a root process. This <code>launchd_sim</code> is effectively the &quot;root process&quot; of the iOS Simulator runtime, but not of the macOS host. This <code>launchd_sim</code> is required by the Simulator OS in order to launch Applications, manage services etc. Each launched iOS Simulator has it&#x27;s own <code>launchd_sim</code> process, launched from the <code>launchd_sim</code> within the <code>SimRuntime</code>. This also means that processes within this nested <code>launchd</code> will only see the processes of the iOS Simulator, rather than all of those of the entire host (including other iOS Simulators running on the same host).</p><p>This <code>launchd_sim</code> can be interrogated the same as the <code>launchd</code> of the host, provided that the <code>launchctl</code> called is spawned within the <code>launchd_sim</code> of the iOS Simulator.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="device-sets">Device Sets<a aria-hidden="true" class="hash-link" href="#device-sets" title="Direct link to heading">â€‹</a></h2><p>A Device Set is essentially a directory that contains a number of created iOS Simulators. The &quot;Default Device Set&quot; is located at <code>~/Library/Developer/CoreSimulator/Devices</code>, this is the device set that is used by <code>Xcode.app</code>.</p><p>Custom device sets can be placed at any location on disk. This is useful for isolating the filesystems of created iOS Simulators from each other. For instance, if there are independent processes managing iOS Simulators on the same host it can be worthwhile having each of these processes manage their own device sets to prevent data races.</p><p>There is also an <code>XCTestDevices</code> directory at <code>~/Library/Developer/XCTestDevices</code>. This is the set of Simulators that are used by <code>xcodebuild</code>, distinct from the user interface. This means that <code>xcodebuild</code> can manage and use it&#x27;s own set of iOS Simulators, independent of the Xcode UI. This may exist for a similar reasons to why custom device sets are practical for automation scenarios. It would also be a confusing user experience if an iOS Simulator that was being used within <code>xcodebuild</code> was using an iOS Simulator that a user was using via Xcode when running UI Tests.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="simulatorapp"><code>Simulator.app</code><a aria-hidden="true" class="hash-link" href="#simulatorapp" title="Direct link to heading">â€‹</a></h2><p>This is the &quot;Simulator&quot; Application with which most developers will be familiar with. This Application effectively mirrors the state of launched iOS Simulators within <code>CoreSimulatorService</code>. It is not an essential part of booting and managing iOS Simulators; iOS Simulators can be booted and used without a <code>Simulator.app</code> launched for it. This makes using Simulators more practical in automation scenarios where a running macOS Application representing the iOS Simulator is not important or even desirable.</p><p>The Simulator Application will default to showing all iOS Simulators that are within the &quot;Default Device Set&quot;. This means that booted iOS Simulators within &quot;Custom Device Sets&quot; will not be displayed within <code>Simulator.app</code>.</p><p>The functionality within this Application is largely implemented within <code>CoreSimulator.framework</code> and <code>SimulatorKit.framework</code>, with the UI implemented directly within the application itself.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="framebuffers-via-iosurface">Framebuffers via <code>IOSurface</code><a aria-hidden="true" class="hash-link" href="#framebuffers-via-iosurface" title="Direct link to heading">â€‹</a></h2><p>The screen from an iOS Simulator is rendered, regardless of whether there is an iOS Simulator application that is presenting this within a IO. An iOS Simulator can be launched independently of <code>Simulator.app</code>, since Simulators are kept alive by <code>CoreSimulatorService</code>.</p><p>In order for other Applications (mainly <code>Simulator.app</code>, but also for video recording within <code>simctl</code>) to get the iOS Simulator&#x27;s Framebuffer for rendering, <code>CoreSimulator</code> can access the <code>IOSurface</code> of the screen of an iOS Simulator. A Simulator can have many screens, for instance when Simulating CarPlay and the main screen at the same time.</p><p>An <code>IOSurface</code> is an object that wraps a Framebuffer, with the contents of the Framebuffer being located within GPU memory. This <code>IOSurface</code> can be read and inspected across process boundaries. The iOS Simulator uses this <code>IOSurface</code> as the backing Framebuffer for it&#x27;s view of an iOS Simulator.</p><p><code>IOSurface</code> objects are also easily convertable to <a href="https://github.com/facebook/idb/blob/d587458fa2188fbcdd3f71fcbb2a131903cfa5f2/FBSimulatorControl/Framebuffer/FBSimulatorVideoStream.m#L398" target="_blank" rel="noopener noreferrer">&quot;Pixel Buffer&quot; types that are used in video encoding</a>. This allows <code>FBSimulatorControl</code> to implement video encoding of an iOS Simulator&#x27;s Framebuffer in a way that avoids large copies of bitmap framebuffers on a per-frame basis.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="indigohid"><code>IndigoHID</code><a aria-hidden="true" class="hash-link" href="#indigohid" title="Direct link to heading">â€‹</a></h2><p>&quot;Indigo&quot; is a service present in the iOS Simulator that is used inside <code>Simulator.app</code> to synthesize &quot;Input Events&quot; that are understood within the iOS Simulator. This service is how clicking on the UI of the <code>Simulator.app</code> translate into touches within the iOS Simulator.</p><p>This uses &quot;mach&quot; IPC, where data structures are sent over a channel using <code>mach_msg_send</code>. These data structures are defined through the &quot;Mach Interface Generator&quot;, which get compiled out of the <code>Simulator.app</code> binary. As such, <code>FBSimulatorControl</code>&#x27;s understanding of the layout and values in these data structures <a href="https://github.com/facebook/idb/blob/main/PrivateHeaders/SimulatorApp/Indigo.h#L40" target="_blank" rel="noopener noreferrer">are understood through reverse engineering</a>.</p><p>The reverse engineering of this protocol, allows <code>FBSimulatorControl</code> to expose APIs that allow sending of touch events directly to the iOS Simulator without using Accessibility APIs in a UI Test. The combination of video streams and APIs for sending input events allows for the building of applications that expose a remote iOS Simulator.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="simulatorkitframework"><code>SimulatorKit.framework</code><a aria-hidden="true" class="hash-link" href="#simulatorkitframework" title="Direct link to heading">â€‹</a></h2><p>This is another macOS Framework that is used in iOS Simulator management. This Framework is not installed to the System, it is bundled within Xcode. Instead, this Framework is more used to implement functionality within <code>Simulator.app</code>.</p><p>For example, this Framework contains some of the <code>Indigo</code> client functionality for sending input events.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/commands"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Commands</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/fbdevicecontrol"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">FBDeviceControl<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#coresimulatorframework" class="table-of-contents__link toc-highlight"><code>CoreSimulator.framework</code></a></li><li><a href="#simctl" class="table-of-contents__link toc-highlight"><code>simctl</code></a></li><li><a href="#coresimulatorservice" class="table-of-contents__link toc-highlight"><code>CoreSimulatorService</code></a></li><li><a href="#simruntime" class="table-of-contents__link toc-highlight"><code>SimRuntime</code></a></li><li><a href="#launchd_sim" class="table-of-contents__link toc-highlight"><code>launchd_sim</code></a></li><li><a href="#device-sets" class="table-of-contents__link toc-highlight">Device Sets</a></li><li><a href="#simulatorapp" class="table-of-contents__link toc-highlight"><code>Simulator.app</code></a></li><li><a href="#framebuffers-via-iosurface" class="table-of-contents__link toc-highlight">Framebuffers via <code>IOSurface</code></a></li><li><a href="#indigohid" class="table-of-contents__link toc-highlight"><code>IndigoHID</code></a></li><li><a href="#simulatorkitframework" class="table-of-contents__link toc-highlight"><code>SimulatorKit.framework</code></a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/fbOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://discord.gg/SF26Yqw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contribute</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/idb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_SRtH"><img src="/img/oss_logo.png" alt="idb" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/img/oss_logo.png" alt="idb" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2022 Facebook, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ae795ba2.js"></script>
<script src="/assets/js/main.c677850e.js"></script>
</body>
</html>