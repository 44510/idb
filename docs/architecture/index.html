<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.69">
<script src="https://buttons.github.io/buttons.js"></script><title data-react-helmet="true">Architecture | idb</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Architecture | idb"><meta data-react-helmet="true" name="description" content="idb is formed of two components that have different responsibilities. Both these components are necessary for idb to run commands."><meta data-react-helmet="true" property="og:description" content="idb is formed of two components that have different responsibilities. Both these components are necessary for idb to run commands."><meta data-react-helmet="true" property="og:url" content="https://fbidb.io/docs/architecture"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://fbidb.io/docs/architecture"><link rel="stylesheet" href="/styles.f46bdb2c.css">
<link rel="preload" href="/styles.f84ebf98.js" as="script">
<link rel="preload" href="/runtime~main.403efedf.js" as="script">
<link rel="preload" href="/main.0dd612e6.js" as="script">
<link rel="preload" href="/1.07b14088.js" as="script">
<link rel="preload" href="/15.31a421ae.js" as="script">
<link rel="preload" href="/16.c188f9e7.js" as="script">
<link rel="preload" href="/935f2afb.adec7177.js" as="script">
<link rel="preload" href="/14.0dda3966.js" as="script">
<link rel="preload" href="/fd532226.f5dd3021.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_2AhQ">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><strong class="navbar__title">idb</strong></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/overview">Getting Started</a><a class="navbar__item navbar__link" href="/docs/installation">Docs</a><a href="https://github.com/facebook/idb" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><strong class="navbar__title">idb</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/overview">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/installation">Docs</a></li><li class="menu__list-item"><a href="https://github.com/facebook/idb" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive thin-scrollbar menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/guided-tour">Guided Tour</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docs/architecture">Architecture</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/commands">Commands</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/test-execution">Test Execution</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/accessibility">Accessibility Automation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/faqs">Frequently Asked Questions</a></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_39qw"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Architecture</h1></header><div class="markdown"><p><code>idb</code> is formed of two components that have different responsibilities. Both these components are necessary for <code>idb</code> to run commands.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-idb-cli"></a>The <code>idb</code> cli<a class="hash-link" href="#the-idb-cli" title="Direct link to heading">#</a></h2><p>This is a python3 cli that exposes all of the functionality that idb has to offer. As it is written in Python, this does not need to be run from the Mac to which your iPhone or iOS Simulator is attached.</p><p>The cli itself is a thin wrapper for a client of the <code>idb_companion</code>. All communication to the <code>idb_companion</code> is done via <code>gRPC</code>. This can be either through TCP or a Unix Domain Socket.</p><p>This client library can be imported into your own python3 code if you wish, or the CLI can be called from any other kind of automation.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="the-idb_companion"></a>The <code>idb_companion</code><a class="hash-link" href="#the-idb_companion" title="Direct link to heading">#</a></h2><p>The <code>idb_companion</code> is a <code>gRPC</code> server in Objective-C++ that runs on macOS. It talks to the native APIs that are used for automating Simulators and Devices. It links the <code>FBSimulatorControl</code> and <code>FBDeviceControl</code> Frameworks, which are part of the overall <code>idb</code> project.</p><p>When the <code>idb_companion</code> acts as <code>gRPC</code> server, it does so for a <em>single</em> iOS target (a device or simulator).</p><p>Additionally, the <code>idb_companion</code> has some commands that are deliberately unavailable from the python CLI, these operations are related to iOS Device management or operations on the lifecycle of a Simulator.</p><img alt="idb architecture" src="/img/idb_architecture.png"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="connections"></a>Connections<a class="hash-link" href="#connections" title="Direct link to heading">#</a></h2><p>The <code>idb</code> cli will, by default operate in one of two modes:</p><ul><li>If the <code>idb</code> cli is running on macOS, then it will automatically start and stop companions for all targets that are attached to your Mac. This means that you can run commands against any iOS Simulators that you have, as well as any devies that you have connected.</li><li>If the <code>idb</code> cli is running on any other OS, it will not manage companions for you. In this case you can either &quot;attach&quot; companions via <code>idb connect</code> or explictly on every call using the <code>IDB_COMPANION=hostname:port</code> environment variable. This allows you to perform <code>idb</code> commands against companions running on other hosts. These facilities for companion discovery work on macOS also.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="differences-between-devices-simulators--emulators"></a>Differences between Devices, Simulators &amp; Emulators<a class="hash-link" href="#differences-between-devices-simulators--emulators" title="Direct link to heading">#</a></h2><p>iOS Devices and Simulators behave in substantially different ways, as well as Simulators behaving very differently to Emulators (for instance Android emulators):</p><ul><li>iOS Simulators and their child processes, appear as regular processes on the host operating system.</li><li>iOS Simulators run executables that are native to macOS. This is unlike emulators for Android which may run across a variety of host operating systems, will always run native Android executables and may translate <a href="https://en.wikipedia.org/wiki/Instruction_set_architecture" target="_blank" rel="noopener noreferrer">between ISAs</a>.</li><li>As iOS Simulators appear as native processes to macOS, many of the macOS level APIs for interacting with files and processes work just the same. This is useful in implementing Simulator functionality.</li><li>iOS Simulators do not use exactly the same system frameworks as macOS. These Frameworks are implemented in the &quot;Simulator Runtime&quot; that is bundled within Xcode. The runtime contains Frameworks that are broadly the same as those on an iOS Device, except they are compiled for the macOS host archiecture.</li><li>As Simulators run natively, they have similar performance characteristics to that of the host. In a sense Simulator Applications perform in a similar way to a macOS application running on macOS. This usually means that Simulators are substantially more performant than emulators, even when an emulator has access to a hypervisor and is running the same ISA.</li><li>iOS Simulators have the concept of a &quot;root&quot; directory, which can be thought of as the Simulator&#x27;s Filesystem. Applications running inside the Simulator still have access to files outside of this root (there is no <a href="https://en.wikipedia.org/wiki/Chroot" target="_blank" rel="noopener noreferrer"><code>chroot</code>&#x27;ing</a> inside of the Simulator), so are able to manipulate files that outside of this root. Applications are also able to manipulate files outside of their own &quot;Application Sandbox&quot; which is not the case on iOS Devices.</li><li>This lack of isolation in iOS Simulators is a double edged sword. It can make certain automation cases more convenient to implement, but it is not easy to ensure that a Simulator has access to a limited amount of system resources. For example, emulators typically allow setting an upper limit on the number of cores or memory that can be consumed by the &quot;guest&quot; OS, where iOS Simulators can access the same resources that any application on the host can. This makes it harder to isolate multiple iOS Simulators running on the same host from each other. For instance, an iOS Simulator Application that consumes extreme amounts of system resources will exhaust these resources for other applications, processes or Simulators running on the same host.</li><li>iOS Devices are very strict about isolating processes from each other as well as the host to which it is attached. Interaction between the host and attached iOS Device is only possible through purpose-built APIs that exposes functionality for existing host-device behaviours. For instance, iOS App launching is implemented on iOS Devices through APIs that are used by the &quot;Instruments&quot; Application. This functionality is typically provided over a socket transport, with varying different protocol implementations depending on the domain. Access to these services is arbitrated via a <code>lockdown</code> service running on the iOS Device.</li><li>As such, the implementations for functionality across iOS Simulators &amp; Devices are drastically different, even within Xcode&#x27;s own Frameworks.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="framework-concepts"></a>Framework Concepts<a class="hash-link" href="#framework-concepts" title="Direct link to heading">#</a></h2><p>There are two frameworks in <code>FBSimulatorControl</code> and <code>FBDeviceControl</code> that exist to implement the majority of the functionality used by <code>idb</code>. Additionally, there is the <code>FBControlCore</code> Framework that exists to define common interfaces for the Device and Simulator Frameworks and to provide other functionality that is common to both. These Frameworks are able to be used independently of <code>idb</code> itself. This is an overview of how these Frameworks are designed together</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="targets"></a>Targets<a class="hash-link" href="#targets" title="Direct link to heading">#</a></h3><p>A instance of a target (<code>FBiOSTarget</code>) is an object that represents a single iOS Simulator or Device. <code>FBiOSTarget</code> is a protocol definition that describes the functionality that is implemented by both <code>FBSimulator</code> and <code>FBDevice</code>. This abstraction means that higher-level applications and Frameworks are able to treat a target then same, regardless of whether it is an iOS Simulator or Device.</p><p>As there are substantial differences in the way that iOS Simulators and Devices operate, this level of abstraction allows the Frameworks to smooth over the differences present in implementing common functionality.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="target-sets"></a>Target Sets<a class="hash-link" href="#target-sets" title="Direct link to heading">#</a></h3><p>A &quot;Target Set&quot; (<code>FBiOSTargetSet</code>) represents a collection of targets. These are implemented in both <code>FBSimulatorSet</code> and <code>FBDeviceSet</code>. A Simulator set represents a root directory that is common to a number of Simulators. A Device Set represents all of the Devices attached to the host.</p><p>This abstraction allows for interfaces to &quot;CRUD&quot; operations on both Simulators and Devices, despite having different implementations. For instance the same API is used across Simulators and Devices for <code>erasing</code> them.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="configuration-values"></a>Configuration Values<a class="hash-link" href="#configuration-values" title="Direct link to heading">#</a></h3><p>Across the Frameworks, there are &quot;Configuration&quot; values, implemented as Objective-C classes. These are typically used for consolidating all the information required for a particular API call. For instance <code>FBApplicationLaunchConfiguration</code> defines launch arguments, environment and launch modes.</p><p>These types exist so that APIs do not require extremely long and cumbersome argument lists, as well as providing sane defaults. These types are intentionally as behaviour-less as possible, close to pure value types.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="command-protocols--implementations"></a>Command Protocols &amp; Implementations<a class="hash-link" href="#command-protocols--implementations" title="Direct link to heading">#</a></h3><p>The protocols provide common APIs across Simulators and Devices. This allows the caller to treat the reciever the same, whether it is a Simulator or Device. There may be some protocols that are only supported by one or the other, depending on the target. For instance there is no concept of &quot;Activation&quot; on a iOS Simulator, so <code>FBDeviceActivationCommands</code> is only implemented by <code>FBDevice</code>.</p><p>Implementations across Simulators &amp; Devices are completely separated and implemented in their respective Frameworks. As an example, <code>FBApplicationCommands</code> (which provides an API for launching and listing Applications on an iOS Target), is implemented separately in <code>FBSimulatorApplicationCommands</code> and <code>FBDeviceApplicationCommands</code>.</p><p>If functionality is common to both Simulators &amp; Devices, it&#x27;s protocol is added to <code>FBiOSTarget</code> so that implementors of <code>FBiOSTarget</code> are required to implement it. For functionality that is not common, the relevant protocol is added to the definition of the concrete <code>FBSimulator</code> or <code>FBDevice</code> class. For non-common protocols, the caller must either check for protocol conformance before calling an API, or use the concrete type directly.</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/guided-tour"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Guided Tour</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/commands"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Commands Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-idb-cli" class="table-of-contents__link">The <code>idb</code> cli</a></li><li><a href="#the-idb_companion" class="table-of-contents__link">The <code>idb_companion</code></a></li><li><a href="#connections" class="table-of-contents__link">Connections</a></li><li><a href="#differences-between-devices-simulators--emulators" class="table-of-contents__link">Differences between Devices, Simulators &amp; Emulators</a></li><li><a href="#framework-concepts" class="table-of-contents__link">Framework Concepts</a><ul><li><a href="#targets" class="table-of-contents__link">Targets</a></li><li><a href="#target-sets" class="table-of-contents__link">Target Sets</a></li><li><a href="#configuration-values" class="table-of-contents__link">Configuration Values</a></li><li><a href="#command-protocols--implementations" class="table-of-contents__link">Command Protocols &amp; Implementations</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/fbOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://discord.gg/SF26Yqw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Contribute</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/idb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1zJy"><img class="footer__logo" alt="idb" src="/img/oss_logo.png"></a></div><div>Copyright Â© 2020 Facebook, Inc.</div></div></div></footer></div>
<script src="/styles.f84ebf98.js"></script>
<script src="/runtime~main.403efedf.js"></script>
<script src="/main.0dd612e6.js"></script>
<script src="/1.07b14088.js"></script>
<script src="/15.31a421ae.js"></script>
<script src="/16.c188f9e7.js"></script>
<script src="/935f2afb.adec7177.js"></script>
<script src="/14.0dda3966.js"></script>
<script src="/fd532226.f5dd3021.js"></script>
</body>
</html>